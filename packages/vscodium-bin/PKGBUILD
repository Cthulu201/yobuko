# Maintainer: Cthulu201 <cthulu201@duck.com>
# Contributor: Carson Rueter <roachh at proton mail dot com>
# Contributor: Icelk <main at icelk.dev>
# Contributor: Cameron Katri <katri.cameron@gmail.com>
# Contributor: Plague-doctor <plague <at>> privacyrequired <<dot>> com >
# Contributor: me at oguzkaganeren dot com dot tr
# Contributor: Rowisi < nomail <at> private <dot> com >

pkgname="vscodium-bin"
pkgver=1.75.1.23040
pkgrel=4
pkgdesc="Binary releases of VS Code without MS branding/telemetry/licensing."
arch=('x86_64')
url="https://github.com/VSCodium/${pkgname//-bin/""}"
license=('MIT')
groups=('yobuko')
depends=('fontconfig' 'libxtst' 'gtk3' 'python' 'cairo' 'alsa-lib' 'nss'
         'gcc-libs' 'libnotify' 'libxss' 'glibc>=2.28-4')
optdepends=('gvfs:            For move to trash functionality'
           'libdbusmenu-glib: For KDE global menu')
provides=('codium' "${pkgname//-bin/""}")
conflicts=("${pkgname//-bin/""}" "${pkgname//-bin/""}-git")
source=("https://github.com/VSCodium/${pkgname//-bin/""}/releases/download/${pkgver}/VSCodium-linux-x64-${pkgver}.tar.gz")
sha512sums=('9192915d87d55b5835dee70d10e03f6ad110075b1b32809f78cd18a7d9fefb36b3440e14c0c17dd826995a04789517c21e08e0d72a0418923f1dadf2d5ce6d22')

shopt -s extglob

package() {
  cd "${srcdir}" || exit
  install -dm0755 "${pkgdir}/opt/${pkgname}"
  install -dm0755 "${pkgdir}/usr/bin"
  install -dm0755 "${pkgdir}/usr/share"/{applications,pixmaps}
  cp -r "${srcdir}"/!(vscodium-bin?(-uri-handler).desktop|"${pkgname//-bin/""}"-linux-x64-"${pkgver}".tar.gz) "${pkgdir}/opt/${pkgname}"
  ln -s "/opt/${pkgname}/bin/codium" "${pkgdir}/usr/bin/codium"
  ln -s "/opt/${pkgname}/bin/codium" "${pkgdir}/usr/bin/vscodium"
  install -Dm0644 "resources/app/resources/linux/code.png" "${pkgdir}/usr/share/pixmaps/${pkgname//-bin/""}.png"

  # Symlink shell completions
  install -dm0755 "${pkgdir}/usr/share/zsh/site-functions"
  install -dm0755 "${pkgdir}/usr/share/bash-completion/completions"
  ln -s "/opt/${pkgname}/resources/completions/zsh/_codium" "${pkgdir}/usr/share/zsh/site-functions"
  ln -s "/opt/${pkgname}/resources/completions/bash/codium" "${pkgdir}/usr/share/bash-completion/completions"
}
