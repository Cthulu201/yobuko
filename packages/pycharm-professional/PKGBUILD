# Maintainer: Cthulu201 <cthulu201@duck.com>

pkgname="pycharm-professional"
pkgver=2023.1.1
pkgrel=1
pkgdesc="Python IDE for Professional Developers. Professional Edition"
arch=('x86_64')
url='https://www.jetbrains.com/pycharm/'
license=('custom')
groups=('yobuko')
depends=('python')
makedepends=('python-setuptools' 'cython')
optdepends=('python2:           For Python 2 development'
            'ipython:           For enhanced interactive Python shell inside Pycharm'
            'openssh:           For deployment and remote connections'
            'python-setuptools: Packages manager for Python, for project interpreter'
            'python-coverage:   For support code coverage measurement'
            'cython:            For performance debugger'
            'docker-machine:    For support docker inside Pycharm'
            'docker-compose:    For support docker inside Pycharm'
            'vagrant:           For support virtualized development environments'
            'python-pytest:     For support testing inside Pycharm'
            'python-tox:        Python environments for testing tool'
            'jupyter-notebook:  For support Jupyter Notebook')
provides=('pycharm-professional')
conflicts=('pycharm' 'pycharm-community-edition')
options=(!strip)
source=("https://download.jetbrains.com/python/${pkgname}-${pkgver}.tar.gz")
sha512sums=('3e2bbec1c095d144c1d3387a2e18850d20139de5b3a7c919e386827b8845d28a5a88d1e83d50e3ea7cea3fd878fa9d07d4fae77ec069f8fb81021e6669bbfa0b')

build() {
  cd "${srcdir}/${pkgname//-professional/""}-${pkgver}/lib/pty4j/linux/" || exit
  find . -maxdepth 1 -not -path . -type d -not -name 'x86-64' -exec rm -rf {} \;
}

package() {
  cd "${srcdir}/${pkgname//-professional/""}-${pkgver}" || exit
  # Install director(y/ies)
  install -dm0755 "${pkgdir}/usr/share/licenses/${pkgname}/"
  install -dm0755 "${pkgdir}/opt/${pkgname}"
  install -dm0755 "${pkgdir}/usr/bin/"

  # Install license(s)
  mv "license/"* "${pkgdir}/usr/share/licenses/${pkgname}/"
  rmdir "license"

  # Setup executable(s)
  cp -a ./* "${pkgdir}/opt/${pkgname}/"
  ln -s "/opt/${pkgname}/bin/${pkgname//-professional/""}.sh" "${pkgdir}/usr/bin/${pkgname}"
}
