# Maintainer: Cthulu201 <cthulu201@duck.com>
# Contributor: Samarth Ramesh <samarthr1@outlook.com>

pkgname="wingpro"
pkgver=9.0.2.1
pkgrel=3
pkgdesc="Wing IDE Professional is the full-featured Python IDE for professional programmers."
arch=('x86_64')
url="http://www.wingware.com"
license=('custom')
groups=('yobuko')
depends=('python' 'libxcrypt-compat' 'xdg-utils' 'qt5-svg' 'libxcb' 'perl' 'java-runtime')
provides=('wing9')
conflicts=('wing8')
source=("https://wingware.com/pub/${pkgname}/${pkgver}/${pkgname}-${pkgver}-linux-x64.tar.bz2"
        "wingpro.install")
sha512sums=('4d044e77cea4dd903dbbc037d6009ebd04a598075d942748472911311ae5e81e700dbe1b43827daee9b2e00e8ff2bec80ae795614c7a805f284c58e8d4ad6659'
            '7ca46a1fad5aee13ed168fe67f5198113dc48d3aed1545f3951b1f6b2947e773825ce7943a977e687ca2ad72bdf70ce0772c0f1b650fb93ab488f5b74bbb4b89')
options=("!strip")

package() {
  cd "${srcdir}/${pkgname}-${pkgver}-linux-x64" || exit
  ./wing-install.py \
  --install-binary \
  --winghome "${pkgdir}/opt/${pkgname}" \
  --bin-dir "${pkgdir}/usr/bin"

  sed -i "s|${pkgdir}||" "${pkgdir}/opt/${pkgname}/wingdbstub.py"
  sed -i "s|${pkgdir}||" "${pkgdir}/opt/${pkgname}/wing"
  sed -i "s,${pkgdir},,g" "${pkgdir}/opt/${pkgname}/file-list.txt"

  # Copy over patch (if any)
  if [ -d ../patches ]; then
      cp -r ../patches "${pkgdir}/opt/${pkgname}/".
  fi

  chmod +x "${pkgdir}/opt/${pkgname}/resources/linux/desktop/install-linux-desktop.sh"
  install -Dm0644 "${pkgdir}/opt/${pkgname}/LICENSE.txt" "${pkgdir}/usr/share/licenses/${pkgpname}/LICENSE"
}
